-htitle '站内短消息'

.page-title 我的站内短消息

.page-short-messages.grouped-by-user
  -@messages.each do |message|
    :ruby
      created_at = message.created_at.localtime
      content = message.content
      
      i_am_sender   = (current_user == message.sender)
      i_am_receiver = (current_user == message.receiver)
      
      if i_am_sender
        another_user = message.receiver
        klass = 'to'
      elsif i_am_receiver
        another_user = message.sender
        klass = 'from'
      end
      
      exchange_url = "/short_messages/exchange?receiver_id=#{another_user.id}"
      reply_url = "/short_messages/new?receiver_id=#{another_user.id}"
  
    .user-message{:class=>klass}
      .avatar
        =avatar another_user
      .ct
        -if i_am_sender
          %span.user 发送给 #{userlink another_user} :
        -elsif i_am_receiver
          %span.user #{userlink another_user} :  
        %span.text=content
        
      .time=created_at
        
      .ops
        %a.reply{:href=>reply_url} 回复
        %a.look{:href=>exchange_url} 查看 